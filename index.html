<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Basquete Anota AI</title>
  <link rel="icon" type="image/png" href="assets/images/ball.png">
  <!-- Carregando Phaser do CDN para garantir disponibilidade -->
  <script src="https://cdn.jsdelivr.net/npm/phaser@2.6.2/build/phaser.min.js"></script>
  <!-- Scripts do Google removidos temporariamente para debug -->
  <style type="text/css">
    body {
      display: flex;
      align-items: center;
      justify-content: center;
      max-width: 100vw;
      height: 100vh;
      margin: 0;
      box-sizing: border-box;
      background-image: url('assets/images/fundoGame.svg');
      background-repeat: no-repeat;
      background-size: cover;
      background-color: #009aff;
      font-family: Arial, Helvetica, sans-serif;
    }
    canvas {
      border: 2px solid rgb(243, 243, 243);
      border-radius: 10px;
      object-fit: cover;
      width: 100% !important;
      max-width: 400px !important;
    }
    @media screen and (max-width: 750px) {
      body {
        padding: 0;
        background-image: none;
      }
      canvas {
        margin: 0;
        padding: 0;
        border: none;
      }
    }
    @media screen and (min-height: 625px) and (max-width: 750px) {
      canvas {
        margin-top: 7vh;
      }
    }
  </style>
</head>
<body>
  <script type="text/javascript">
    // Variáveis globais
    var game;
    var ball;
    var currentScore = 0;
    var bestScoreCookie = 0;
    var isDown = false;
    var startLocation;
    var endLocation;
    var locationInterval;
    var frontRim;

    // Aguardar o carregamento do Phaser
    window.onload = function() {
      // Verificar se o Phaser foi carregado
      if (typeof Phaser === 'undefined') {
        console.error('Erro: Phaser não foi carregado!');
        document.body.innerHTML = '<p style="color: white; text-align: center;">Erro ao carregar o jogo. Por favor, recarregue a página.</p>';
        return;
      }

      var screenWidth = window.innerWidth;
      var screenHeight = window.innerHeight;
      var mobile = screenWidth <= 750;

      try {
        game = new Phaser.Game(
          mobile ? screenWidth : 400,
          mobile ? screenHeight : 625,
          Phaser.CANVAS,
          '',
          {
            preload: preload,
            create: create,
            update: update
          }
        );
      } catch (error) {
        console.error('Erro ao inicializar o jogo:', error);
        document.body.innerHTML = '<p style="color: white; text-align: center;">Erro ao inicializar o jogo. Por favor, recarregue a página.</p>';
      }
    };

    function preload() {
      console.log('Carregando assets...');
      try {
        // Carregar imagens
        game.load.image('ball', 'assets/images/ball.png');
        game.load.image('hoop', 'assets/images/hoop.png');
        game.load.image('side_rim', 'assets/images/side_rim.png');
        game.load.image('front_rim', 'assets/images/front_rim.png');
        
        // Carregar imagens de vitória
        for (var i = 0; i < 5; i++) {
          game.load.image('win' + i, 'assets/images/win' + i + '.png');
          game.load.image('lose' + i, 'assets/images/lose' + i + '.png');
        }
        
        // Carregar áudios
        game.load.audio('score', 'assets/audio/score.wav');
        game.load.audio('backboard', 'assets/audio/backboard.wav');
        game.load.audio('whoosh', 'assets/audio/whoosh.wav');
        game.load.audio('fail', 'assets/audio/fail.wav');
        game.load.audio('spawn', 'assets/audio/spawn.wav');
      } catch (error) {
        console.error('Erro ao carregar assets:', error);
      }
    }

    function create() {
      console.log('Criando jogo...');
      try {
        game.physics.startSystem(Phaser.Physics.P2JS);
        game.physics.p2.setImpactEvents(true);
        game.physics.p2.restitution = 0.63;
        game.physics.p2.gravity.y = 0;

        var collisionGroup = game.physics.p2.createCollisionGroup();
        var screenWidth = window.innerWidth;
        var mobile = screenWidth <= 750;

        // Configurar sons
        var scoreSound = game.add.audio('score');
        var backboard = game.add.audio('backboard', 0.5);
        var whoosh = game.add.audio('whoosh');
        var fail = game.add.audio('fail', 0.1);
        var spawn = game.add.audio('spawn');

        // Configurar fundo e textos
        game.stage.backgroundColor = '#009aff';
        setupScoreTexts();

        // Configurar cesta
        setupHoop(mobile, screenWidth, collisionGroup);

        // Criar primeira bola
        createBall();

        // Configurar eventos de input
        game.input.onDown.add(click, this);
        game.input.onUp.add(release, this);
      } catch (error) {
        console.error('Erro ao criar jogo:', error);
      }
    }

    function setupScoreTexts() {
      window.currentScoreText = game.add.text(20, 20, '', {
        font: 'Arial',
        fontSize: '40px',
        fill: '#fff',
        align: 'center'
      });
      window.currentBestText = game.add.text(20, 20, 'Melhor pontuação:', {
        font: 'Arial',
        fontSize: '20px',
        fill: '#fff',
        align: 'center'
      });
      window.currentBestScoreText = game.add.text(190, 15, getCookie(), {
        font: 'Arial',
        fontSize: '30px',
        fill: '#fff',
        align: 'center'
      });
    }

    function setupHoop(mobile, screenWidth, collisionGroup) {
      var hoopX = mobile ? (screenWidth / 2) - 112 : 88;
      var leftRimX = mobile ? (screenWidth / 2) - 82 : 119;
      var rightRimX = mobile ? (screenWidth / 2) + 82 : 282;

      var hoop = game.add.sprite(hoopX, 62, 'hoop');
      var leftRim = game.add.sprite(leftRimX, 190, 'side_rim');
      var rightRim = game.add.sprite(rightRimX, 190, 'side_rim');

      setupRim(leftRim, collisionGroup);
      setupRim(rightRim, collisionGroup);
    }

    function setupRim(rim, collisionGroup) {
      game.physics.p2.enable(rim, false);
      rim.body.setCircle(2.5);
      rim.body.static = true;
      rim.body.setCollisionGroup(collisionGroup);
      rim.body.collides([collisionGroup]);
    }

    // Resto das funções (update, click, release, etc.) permanecem as mesmas
    // ... (mantenha o resto do seu código JavaScript original)

    function getCookie() {
      try {
        if (!document.cookie.includes('BestScore')) {
          document.cookie = 'BestScore=0';
          return '0';
        }
        var score = '0';
        document.cookie.split(';').forEach(function(cookie) {
          if (cookie.includes('BestScore')) {
            score = cookie.split('=')[1];
          }
        });
        return score;
      } catch (error) {
        console.error('Erro ao ler cookie:', error);
        return '0';
      }
    }

    function setCookie(newBestScore) {
      try {
        document.cookie = `BestScore=${newBestScore}`;
      } catch (error) {
        console.error('Erro ao salvar cookie:', error);
      }
    }
  </script>
</body>
</html>
