<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Basquete Anota AI</title>
  <link rel="icon" type="image/png" href="assets/images/ball.png">
  <script type="text/javascript" src="js/phaser.min.js"></script>
  <script async src="pagead/js/f.txt?client=ca-pub-2210446009817515" crossorigin="anonymous"></script>
  <script async src="gtag/js?id=G-WSPVKJTS0V"></script>
  <style type="text/css">
    body {
      display: flex;
      align-items: center;
      justify-content: center;
      max-width: 100vw;
      height: 100vh;
      margin: 0;
      box-sizing: border-box;
      background-image: url('assets/images/fundoGame.svg');
      background-repeat: no-repeat;
      background-size: cover;
      background-color: #009aff;
      font-family: Arial, Helvetica, sans-serif;
    }
    canvas {
      border: 2px solid rgb(243, 243, 243);
      border-radius: 10px;
      object-fit: cover;
      width: 100% !important;
      max-width: 400px !important;
    }
    @media screen and (max-width: 750px) {
      body {
        padding: 0;
        background-image: none;
      }
      canvas {
        margin: 0;
        padding: 0;
        border: none;
      }
    }
    @media screen and (min-height: 625px) and (max-width: 750px) {
      canvas {
        margin-top: 7vh;
      }
    }
    @media(max-width: 500px) {
      .adsbygoogle-noablate {
        display: block !important;
        position: fixed !important;
        width: 100% !important;
        bottom: 0;
        left: 0;
      }
      .responsive-ads {
      }
    }
  </style>
</head>
<body>
  <script async src="pagead/js/f.txt?client=ca-pub-2210446009817515" crossorigin="anonymous"></script>
  <ins class="adsbygoogle responsive-ads" style="display: block !important;" data-ad-client="ca-pub-2210446009817515" data-ad-slot="4580182721" data-ad-format="auto" data-full-width-responsive="true"></ins>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
  <script type="text/javascript">
    var screenWidth = screen.width;
    var screenHeight = screen.height;
    var mobile = screenWidth <= 750;
    var game;

    window.onload = function() {
      game = new Phaser.Game(mobile ? screenWidth : 400, mobile ? screenHeight : 625, Phaser.CANVAS, '', {
        preload: preload,
        create: create,
        update: update
      });
    };

    function preload() {
      console.log('Preloading assets...');
      game.load.image('ball', 'assets/images/ball.png');
      game.load.image('hoop', 'assets/images/hoop.png');
      game.load.image('side_rim', 'assets/images/side_rim.png');
      game.load.image('front_rim', 'assets/images/front_rim.png');
      game.load.image('win0', 'assets/images/win0.png');
      game.load.image('win1', 'assets/images/win1.png');
      game.load.image('win2', 'assets/images/win2.png');
      game.load.image('win3', 'assets/images/win3.png');
      game.load.image('win4', 'assets/images/win4.png');
      game.load.image('lose0', 'assets/images/lose0.png');
      game.load.image('lose1', 'assets/images/lose1.png');
      game.load.image('lose2', 'assets/images/lose2.png');
      game.load.image('lose3', 'assets/images/lose3.png');
      game.load.image('lose4', 'assets/images/lose4.png');
      game.load.audio('score', 'assets/audio/score.wav');
      game.load.audio('backboard', 'assets/audio/backboard.wav');
      game.load.audio('whoosh', 'assets/audio/whoosh.wav');
      game.load.audio('fail', 'assets/audio/fail.wav');
      game.load.audio('spawn', 'assets/audio/spawn.wav');
    }

    function create() {
      console.log('Creating game...');
      game.physics.startSystem(Phaser.Physics.P2JS);
      game.physics.p2.setImpactEvents(true);
      game.physics.p2.restitution = 0.63;
      game.physics.p2.gravity.y = 0;

      var collisionGroup = game.physics.p2.createCollisionGroup();
      var scoreSound = game.add.audio('score');
      var backboard = game.add.audio('backboard', 0.5);
      var whoosh = game.add.audio('whoosh');
      var fail = game.add.audio('fail', 0.1);
      var spawn = game.add.audio('spawn');

      game.stage.backgroundColor = '#009aff';

      var currentScoreText = game.add.text(20, 20, '', {
        font: 'Arial',
        fontSize: '40px',
        fill: '#fff',
        align: 'center'
      });
      var currentBestText = game.add.text(20, 20, 'Melhor pontuação:', {
        font: 'Arial',
        fontSize: '20px',
        fill: '#fff',
        align: 'center'
      });
      var currentBestScoreText = game.add.text(190, 15, getCookie(), {
        font: 'Arial',
        fontSize: '30px',
        fill: '#fff',
        align: 'center'
      });

      var hoop, leftRim, rightRim;
      if (mobile) {
        hoop = game.add.sprite((screenWidth / 2) - 112, 62, 'hoop');
        leftRim = game.add.sprite((screenWidth / 2) - 82, 190, 'side_rim');
        rightRim = game.add.sprite((screenWidth / 2) + 82, 190, 'side_rim');
      } else {
        hoop = game.add.sprite(88, 62, 'hoop');
        leftRim = game.add.sprite(119, 190, 'side_rim');
        rightRim = game.add.sprite(282, 190, 'side_rim');
      }

      game.physics.p2.enable([leftRim, rightRim], false);
      leftRim.body.setCircle(2.5);
      leftRim.body.static = true;
      leftRim.body.setCollisionGroup(collisionGroup);
      leftRim.body.collides([collisionGroup]);
      rightRim.body.setCircle(2.5);
      rightRim.body.static = true;
      rightRim.body.setCollisionGroup(collisionGroup);
      rightRim.body.collides([collisionGroup]);

      createBall();

      game.input.onDown.add(click, this);
      game.input.onUp.add(release, this);
    }

    function update() {
      if (ball && ball.body.velocity.y > 0) {
        if (mobile) {
          frontRim = game.add.sprite((screenWidth / 2) - 83, 186, 'front_rim');
        } else {
          frontRim = game.add.sprite(117, 187, 'front_rim');
        }
        ball.body.collides([collisionGroup], hitRim, this);
      }

      if (ball && ball.body.velocity.y > 0 && ball.body.y > 188 && !ball.isBelowHoop) {
        ball.isBelowHoop = true;
        ball.body.collideWorldBounds = false;
        var rand = Math.floor(Math.random() * 5);
        if (ball.body.x > 151 && ball.body.x < 249) {
          var emojiName = "win" + rand;
          currentScore += 1;
          currentScoreText.text = currentScore;
          scoreSound.play();
          if (currentScore > bestScoreCookie) {
            setCookie(currentScore);
          }
        } else {
          var emojiName = "lose" + rand;
          fail.play();
          currentScore = 0;
          currentScoreText.text = '';
          currentBestText.text = 'Melhor pontuação:';
          currentBestScoreText.text = getCookie();
        }
        var emoji = game.add.sprite(mobile ? (screenWidth / 2) - 20 : 180, 100, emojiName);
        emoji.scale.setTo(0.25, 0.25);
        var moveInTween = game.add.tween(emoji).from({
          y: 150
        }, 500, Phaser.Easing.Elastic.Out, true);
        var fadeInTween = game.add.tween(emoji).from({
          alpha: 0
        }, 200, Phaser.Easing.Linear.None, true, 0, 0, false);
        moveInTween.onComplete.add(() => {
          var moveOutTween = game.add.tween(emoji).to({
            y: 50
          }, 600, Phaser.Easing.Elastic.In, true);
          moveOutTween.onComplete.add(() => {
            emoji.kill();
          });
          setTimeout(() => {
            game.add.tween(emoji).to({
              alpha: 0
            }, 300, Phaser.Easing.Linear.None, true, 0, 0, false);
          }, 450);
        });
      }

      if (ball && ball.body.y > 1200) {
        game.physics.p2.gravity.y = 0;
        ball.kill();
        createBall();
      }
    }

    function hitRim() {
      backboard.play();
    }

    function createBall() {
      var xpos = currentScore === 0 ? (mobile ? screenWidth / 2 : 200) : 60 + Math.random() * 250;
      var ball = game.add.sprite(xpos, 547, 'ball');
      game.add.tween(ball.scale).from({
        x: 0.7,
        y: 0.7
      }, 100, Phaser.Easing.Linear.None, true, 0, 0, false);
      game.physics.p2.enable(ball, false);
      ball.body.setCircle(60);
      ball.launched = false;
      ball.isBelowHoop = false;
    }

    function click(pointer) {
      var bodies = game.physics.p2.hitTest(pointer.position, [ball.body]);
      if (bodies.length) {
        startLocation = [pointer.x, pointer.y];
        isDown = true;
        locationInterval = setInterval(() => {
          startLocation = [pointer.x, pointer.y];
        }, 200);
      }
    }

    function release(pointer) {
      if (isDown) {
        clearInterval(locationInterval);
        isDown = false;
        endLocation = [pointer.x, pointer.y];
        if (endLocation[1] < startLocation[1]) {
          var slope = [endLocation[0] - startLocation[0], endLocation[1] - startLocation[1]];
          var xTraj = -800 * slope[0] / slope[1];
          launch(xTraj);
        }
      }
    }

    function launch(xTraj) {
      if (!ball.launched) {
        ball.body.setCircle(36);
        ball.body.setCollisionGroup(collisionGroup);
        currentBestText.text = '';
        currentBestScoreText.text = '';
        ball.launched = true;
        game.physics.p2.gravity.y = 3000;
        game.add.tween(ball.scale).to({
          x: 0.6,
          y: 0.6
        }, 500, Phaser.Easing.Linear.None, true, 0, 0, false);
        ball.body.velocity.x = xTraj;
        ball.body.velocity.y = -1750;
        ball.body.rotateRight(xTraj / 3);
        whoosh.play();
      }
    }

    function getCookie() {
      var scoreCookie;
      if (!document.cookie.includes('BestScore')) {
        document.cookie = `BestScore=0`;
      }
      document.cookie.split(';').forEach(cookie => {
        if (cookie.includes('BestScore')) {
          scoreCookie = cookie.split('=')[1];
        }
      });
      return scoreCookie;
    }

    function setCookie(newBestScore) {
      document.cookie = `BestScore=${newBestScore}`;
    }
  </script>
</body>
</html>
